<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>biogeme.assisted &mdash; Biogeme 3.2.9 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> Biogeme
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../algorithms.html">Algorithms</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../assisted.html">Assisted specification</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../biogeme.html">Biogeme</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../database.html">Database</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../distributions.html">Distributions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../draws.html">Draws</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../exceptions.html">Exceptions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../expressions.html">Expressions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../filenames.html">Filenames</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../idmanager.html">ID manager</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../loglikelihood.html">Log likelihood</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../messaging.html">Messaging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../models.html">Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../optimization.html">Optimization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../results.html">Results</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../segmentation.html">Segmentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../singleton.html">Singleton</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools.html">Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../version.html">Version</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../vns.html">Variable Neighborhood Search</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Biogeme</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../index.html">Module code</a> &raquo;</li>
      <li>biogeme.assisted</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for biogeme.assisted</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;File assisted.py</span>
<span class="sd">:author: Michel Bierlaire, EPFL</span>
<span class="sd">:date: Thu Sep 17 16:21:01 2020</span>

<span class="sd">Assisted specification for choice models</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c1"># pylint: disable=too-many-lines, invalid-name, too-many-instance-attributes</span>
<span class="c1"># pylint: disable=too-many-arguments, too-many-locals</span>
<span class="c1"># pylint: disable=too-many-public-methods, too-many-branches</span>
<span class="c1"># pylint: disable=too-many-statements</span>

<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">namedtuple</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">html</span>
<span class="kn">import</span> <span class="nn">biogeme.biogeme</span> <span class="k">as</span> <span class="nn">bio</span>
<span class="kn">import</span> <span class="nn">biogeme.messaging</span> <span class="k">as</span> <span class="nn">msg</span>
<span class="kn">import</span> <span class="nn">biogeme.exceptions</span> <span class="k">as</span> <span class="nn">excep</span>
<span class="kn">from</span> <span class="nn">biogeme</span> <span class="kn">import</span> <span class="n">vns</span>
<span class="kn">from</span> <span class="nn">biogeme.expressions</span> <span class="kn">import</span> <span class="n">Beta</span><span class="p">,</span> <span class="n">bioMultSum</span>

<span class="c1"># This tuple is imported here, so that it can be imported from here later on.</span>
<span class="kn">from</span> <span class="nn">biogeme.segmentation</span> <span class="kn">import</span> <span class="n">DiscreteSegmentationTuple</span><span class="p">,</span> <span class="n">segment_parameter</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">bioMessage</span><span class="p">()</span>


<span class="n">TermTuple</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s1">&#39;TermTuple&#39;</span><span class="p">,</span> <span class="s1">&#39;attribute segmentation bounds validity&#39;</span><span class="p">)</span>
<span class="n">SegmentedParameterTuple</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span>
    <span class="s1">&#39;SegmentedParameterTuple&#39;</span><span class="p">,</span> <span class="s1">&#39;dict combinatorial&#39;</span>
<span class="p">)</span>


<div class="viewcode-block" id="variable"><a class="viewcode-back" href="../../assisted.html#biogeme.assisted.variable">[docs]</a><span class="k">class</span> <span class="nc">variable</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class representing the possible specifications of a variable</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="variable.__init__"><a class="viewcode-back" href="../../assisted.html#biogeme.assisted.variable.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">expression</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param name: name of the variable</span>
<span class="sd">        :type name: str</span>

<span class="sd">        :param expression: Biogeme expression of the variable.</span>
<span class="sd">        :type expression: :class:`biogeme.expressions.Expression`</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>  <span class="c1">#: name of the variable</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">expression</span> <span class="o">=</span> <span class="n">expression</span>  <span class="c1">#: Biogeme expression for the variable</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">active</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1">#: True if variable is active</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">generic</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1">#: True if the variable is generic.</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">genericName</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1">#: Name of the generic variable</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">nonlinearSpec</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="sd">&quot;&quot;&quot; Function with the nonlinear specifications.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">used</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1">#: True if variable used in the model.</span></div>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Print the specification of the variable</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">active</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1"> [deactivated]&#39;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nonlinearSpec</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">generic</span><span class="p">:</span>
                <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1"> [generic]&#39;</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1"> [alt. spec.]&#39;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">generic</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">nonlinearSpec</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">expression</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span>
                <span class="sa">f</span><span class="s1">&#39; [generic]&#39;</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">nonlinearSpec</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">expression</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span>
            <span class="sa">f</span><span class="s1">&#39; [alt. spec.]&#39;</span>
        <span class="p">)</span>

<div class="viewcode-block" id="variable.makeGeneric"><a class="viewcode-back" href="../../assisted.html#biogeme.assisted.variable.makeGeneric">[docs]</a>    <span class="k">def</span> <span class="nf">makeGeneric</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">yes</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;A variable can have two status: generic or alternative</span>
<span class="sd">        specific. This function changes the status</span>

<span class="sd">        :param yes: if True, status is set to &quot;generic&quot;.</span>
<span class="sd">                    If False, status is set to &quot;alt. specific&quot;.</span>
<span class="sd">        :type yes: bool</span>

<span class="sd">        :param name: name of the generic version of the variable</span>
<span class="sd">        :type name: str</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">generic</span> <span class="o">=</span> <span class="n">yes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">genericName</span> <span class="o">=</span> <span class="n">name</span></div>

<div class="viewcode-block" id="variable.getExpression"><a class="viewcode-back" href="../../assisted.html#biogeme.assisted.variable.getExpression">[docs]</a>    <span class="k">def</span> <span class="nf">getExpression</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the biogeme expression of the specification of the variable.</span>

<span class="sd">        :return: expression accozunting for the status and the</span>
<span class="sd">            nonlinear specification.</span>
<span class="sd">        :rtype: :class:`biogeme.expressions.Expression`</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">active</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nonlinearSpec</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">expression</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">nonlinearSpec</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">expression</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span></div></div>


<div class="viewcode-block" id="groupOfVariables"><a class="viewcode-back" href="../../assisted.html#biogeme.assisted.groupOfVariables">[docs]</a><span class="k">class</span> <span class="nc">groupOfVariables</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Class representing groups of variables. All variables in the group</span>
<span class="sd">    will have the same nonlinear spec. They can also share the same</span>
<span class="sd">    coefficient.</span>

<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="groupOfVariables.__init__"><a class="viewcode-back" href="../../assisted.html#biogeme.assisted.groupOfVariables.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">variables</span><span class="p">,</span> <span class="n">nonlinearSpecs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Ctor</span>

<span class="sd">        :param name: name of the group of variables</span>
<span class="sd">        :type name: str</span>

<span class="sd">        :param variables: list of variables in the group</span>
<span class="sd">        :type varariables: list(variable)</span>

<span class="sd">        :param nonlinearSpecs: list of possible nonlinear specifications</span>
<span class="sd">        :type nonlinearSpecs: list(function)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>  <span class="c1">#: name of the group of variables.</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">variables</span> <span class="o">=</span> <span class="n">variables</span>  <span class="c1">#: list of variables in the group.</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">genericForbiden</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">1</span>
        <span class="sd">&quot;&quot;&quot; True of the group cannot be made generic</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">generic</span> <span class="o">=</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">genericForbiden</span>
        <span class="sd">&quot;&quot;&quot; True if the group is generic.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">alwaysActive</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="sd">&quot;&quot;&quot; True if the group is always active.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">active</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1">#: True if the group is active.</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">nonlinearSpecs</span> <span class="o">=</span> <span class="n">nonlinearSpecs</span>
        <span class="sd">&quot;&quot;&quot; list of possible nonlinear specifications</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">selection</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="sd">&quot;&quot;&quot;Index of the selected non linear specification.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">linear</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1">#: True if linear specification.</span></div>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">v</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">generic</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s1">  [generic][active:</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">active</span><span class="si">}</span><span class="s1">]&#39;</span>

        <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s1"> [not generic][active:</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">active</span><span class="si">}</span><span class="s1">]&#39;</span>

<div class="viewcode-block" id="groupOfVariables.forbidGeneric"><a class="viewcode-back" href="../../assisted.html#biogeme.assisted.groupOfVariables.forbidGeneric">[docs]</a>    <span class="k">def</span> <span class="nf">forbidGeneric</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Forbid the generic specification in the group&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">genericForbiden</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">generic</span> <span class="o">=</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="groupOfVariables.forceActive"><a class="viewcode-back" href="../../assisted.html#biogeme.assisted.groupOfVariables.forceActive">[docs]</a>    <span class="k">def</span> <span class="nf">forceActive</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Force the variables in the group to be active.&quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">detailed</span><span class="p">(</span>
            <span class="sa">f</span><span class="s1">&#39;Group of variables </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1"> &#39;</span> <span class="sa">f</span><span class="s1">&#39;must be in the model.&#39;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">activate</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alwaysActive</span> <span class="o">=</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="groupOfVariables.activate"><a class="viewcode-back" href="../../assisted.html#biogeme.assisted.groupOfVariables.activate">[docs]</a>    <span class="k">def</span> <span class="nf">activate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">yes</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;A group of variables can have two status: activated or not. This</span>
<span class="sd">        function changes the status.</span>

<span class="sd">        :param yes: if True, activates the group. If False,</span>
<span class="sd">            desactivate the group.</span>
<span class="sd">        :type yes: bool</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">alwaysActive</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">active</span> <span class="o">=</span> <span class="n">yes</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">:</span>
            <span class="n">v</span><span class="o">.</span><span class="n">active</span> <span class="o">=</span> <span class="n">yes</span></div>

<div class="viewcode-block" id="groupOfVariables.swapActivate"><a class="viewcode-back" href="../../assisted.html#biogeme.assisted.groupOfVariables.swapActivate">[docs]</a>    <span class="k">def</span> <span class="nf">swapActivate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Change the activation status&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">alwaysActive</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">excep</span><span class="o">.</span><span class="n">biogemeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;Variable </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1"> &#39;</span> <span class="sa">f</span><span class="s1">&#39;cannot be made inactive.&#39;</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">activate</span><span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">active</span><span class="p">)</span></div>

<div class="viewcode-block" id="groupOfVariables.makeGeneric"><a class="viewcode-back" href="../../assisted.html#biogeme.assisted.groupOfVariables.makeGeneric">[docs]</a>    <span class="k">def</span> <span class="nf">makeGeneric</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">yes</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A group of variables can be generic or alternative specific.</span>
<span class="sd">        This function changes the status.</span>

<span class="sd">        :param yes: if True, status is set to &quot;generic&quot;.</span>
<span class="sd">                    If False, status is set to &quot;alt. specific&quot;.</span>
<span class="sd">        :type yes: bool</span>

<span class="sd">        :raise biogemeError: if the variable cannot be made generic.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">yes</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">genericForbiden</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">excep</span><span class="o">.</span><span class="n">biogemeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;Variable </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1"> &#39;</span> <span class="sa">f</span><span class="s1">&#39;cannot be made generic.&#39;</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">generic</span> <span class="o">=</span> <span class="n">yes</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">:</span>
            <span class="n">v</span><span class="o">.</span><span class="n">makeGeneric</span><span class="p">(</span><span class="n">yes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span></div>

<div class="viewcode-block" id="groupOfVariables.swapGeneric"><a class="viewcode-back" href="../../assisted.html#biogeme.assisted.groupOfVariables.swapGeneric">[docs]</a>    <span class="k">def</span> <span class="nf">swapGeneric</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Change the generic/alt. specific status&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">genericForbiden</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">excep</span><span class="o">.</span><span class="n">biogemeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;Variable </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1"> &#39;</span> <span class="sa">f</span><span class="s1">&#39;cannot be made generic.&#39;</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">makeGeneric</span><span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">generic</span><span class="p">)</span></div>

<div class="viewcode-block" id="groupOfVariables.setLinear"><a class="viewcode-back" href="../../assisted.html#biogeme.assisted.groupOfVariables.setLinear">[docs]</a>    <span class="k">def</span> <span class="nf">setLinear</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">yes</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;A group of variables can be linear or not. This function changes</span>
<span class="sd">        the status.</span>

<span class="sd">        :param yes: if True, status is set to &quot;linear&quot;.</span>
<span class="sd">                    If False, status is set to &quot;nonlinear&quot;.</span>
<span class="sd">        :type yes: bool</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nonlinearSpecs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">linear</span> <span class="o">=</span> <span class="n">yes</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">yes</span><span class="p">:</span>
                <span class="n">v</span><span class="o">.</span><span class="n">nonlinearSpec</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">v</span><span class="o">.</span><span class="n">nonlinearSpec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nonlinearSpecs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">selection</span><span class="p">]</span></div>

<div class="viewcode-block" id="groupOfVariables.swapLinear"><a class="viewcode-back" href="../../assisted.html#biogeme.assisted.groupOfVariables.swapLinear">[docs]</a>    <span class="k">def</span> <span class="nf">swapLinear</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Change the linearity status.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nonlinearSpecs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setLinear</span><span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">linear</span><span class="p">)</span></div>

<div class="viewcode-block" id="groupOfVariables.setSelection"><a class="viewcode-back" href="../../assisted.html#biogeme.assisted.groupOfVariables.setSelection">[docs]</a>    <span class="k">def</span> <span class="nf">setSelection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sel</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set the selection of the nonlinear specification.</span>

<span class="sd">        :param sel: index of list self.nonlinearSpecs corresponding to</span>
<span class="sd">            the nonlinear spec.</span>
<span class="sd">        :type sel: int</span>

<span class="sd">        :raise biogemeError: if the index is out of range.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nonlinearSpecs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="n">sel</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">sel</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nonlinearSpecs</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">excep</span><span class="o">.</span><span class="n">biogemeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;Index </span><span class="si">{</span><span class="n">sel</span><span class="si">}</span><span class="s1"> out of range [0, &#39;</span>
                <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nonlinearSpecs</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="si">}</span><span class="s1">]&#39;</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selection</span> <span class="o">=</span> <span class="n">sel</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">linear</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">:</span>
                <span class="n">v</span><span class="o">.</span><span class="n">nonlinearSpec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nonlinearSpecs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">selection</span><span class="p">]</span></div>

<div class="viewcode-block" id="groupOfVariables.getDecisions"><a class="viewcode-back" href="../../assisted.html#biogeme.assisted.groupOfVariables.getDecisions">[docs]</a>    <span class="k">def</span> <span class="nf">getDecisions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The decision is an integer representing the decisions with</span>
<span class="sd">        respect to the group of variables:</span>


<span class="sd">        :return: decision with respect to the group of variables</span>

<span class="sd">        - -3 if it is inactive</span>
<span class="sd">        - -2 if it is active, generic and linear</span>
<span class="sd">        - -1 if it is active, alt. specific and linear</span>
<span class="sd">        - index of the nonlinear specification if active, generic</span>
<span class="sd">          and nonlinear.</span>
<span class="sd">        - 100 plus the index of the nonlinear specification if active,</span>
<span class="sd">          alt. specific and nonlinear.</span>

<span class="sd">        :rtype: int</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">active</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="o">-</span><span class="mi">3</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">linear</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">generic</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">linear</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">generic</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">generic</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">selection</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="mi">100</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">selection</span>

        <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="groupOfVariables.setDecisions"><a class="viewcode-back" href="../../assisted.html#biogeme.assisted.groupOfVariables.setDecisions">[docs]</a>    <span class="k">def</span> <span class="nf">setDecisions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">decision</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Implement the decision, after verifying its validity</span>

<span class="sd">        :param decision:</span>

<span class="sd">        - -3 if it is inactive</span>
<span class="sd">        - -2 if it is active, generic and linear</span>
<span class="sd">        - -1 if it is active, alt. specific and linear</span>
<span class="sd">        - index of the nonlinear specification if active, generic</span>
<span class="sd">          and nonlinear.</span>
<span class="sd">        - 100 plus the index of the nonlinear specification if active,</span>
<span class="sd">          alt. specific and nonlinear.</span>

<span class="sd">        :type decision: int</span>

<span class="sd">        :raise biogemeError: if the decision is to deactive, while</span>
<span class="sd">            the group should always be active.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">decision</span> <span class="o">==</span> <span class="o">-</span><span class="mi">3</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">alwaysActive</span><span class="p">:</span>
            <span class="n">error_msg</span> <span class="o">=</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;Group of variables </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1"> cannot be desactivated&#39;</span>
            <span class="p">)</span>
            <span class="k">raise</span> <span class="n">excep</span><span class="o">.</span><span class="n">biogemeError</span><span class="p">(</span><span class="n">error_msg</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">activate</span><span class="p">(</span><span class="n">decision</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">3</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">decision</span> <span class="o">==</span> <span class="o">-</span><span class="mi">3</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">decision</span> <span class="o">==</span> <span class="o">-</span><span class="mi">2</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">makeGeneric</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setLinear</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">decision</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">makeGeneric</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setLinear</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setLinear</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nonlinearSpecs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">excep</span><span class="o">.</span><span class="n">biogemeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;No nonlinear specification has &#39;</span>
                <span class="sa">f</span><span class="s1">&#39;been provided for </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">&#39;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">decision</span> <span class="o">&lt;</span> <span class="mi">100</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">makeGeneric</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setSelection</span><span class="p">(</span><span class="n">decision</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">makeGeneric</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setSelection</span><span class="p">(</span><span class="n">decision</span> <span class="o">-</span> <span class="mi">100</span><span class="p">)</span>
        <span class="k">return</span></div></div>


<div class="viewcode-block" id="term"><a class="viewcode-back" href="../../assisted.html#biogeme.assisted.term">[docs]</a><span class="k">class</span> <span class="nc">term</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Class representing the possible specifications of one term of the</span>
<span class="sd">    utility function</span>

<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="term.__init__"><a class="viewcode-back" href="../../assisted.html#biogeme.assisted.term.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="n">aSegmentation</span><span class="p">,</span> <span class="n">bounds</span><span class="p">,</span> <span class="n">validity</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Ctor</span>

<span class="sd">        :param var: variable of the term.</span>
<span class="sd">        :type var: variable</span>

<span class="sd">        :param aSegmentation: discrete segmentation for the parameter</span>
<span class="sd">        :type aSegmentation: segmentation</span>

<span class="sd">        :param bounds: bounds on the coefficient</span>
<span class="sd">        :type bounds: tuple(float, float)</span>

<span class="sd">        :param validity: function checking the validity of the coefficient.</span>
<span class="sd">        :type validity: bool f(float)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">var</span> <span class="o">=</span> <span class="n">var</span>  <span class="c1">#: variable of the term</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">segmentation</span> <span class="o">=</span> <span class="n">aSegmentation</span>
        <span class="sd">&quot;&quot;&quot; discrete segmentation of the parameter</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">coef_names</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="sd">&quot;&quot;&quot;names of the Beta parameters involved in the specification of the</span>
<span class="sd">        term.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">validity</span> <span class="o">=</span> <span class="n">validity</span>
        <span class="sd">&quot;&quot;&quot; function checking the validity of the coefficient.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">bounds</span> <span class="o">=</span> <span class="n">bounds</span>  <span class="c1">#: bounds on the coefficient</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">var</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">used</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">segmentation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">segmentation</span><span class="o">.</span><span class="n">used</span> <span class="o">=</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="term.getDecisions"><a class="viewcode-back" href="../../assisted.html#biogeme.assisted.term.getDecisions">[docs]</a>    <span class="k">def</span> <span class="nf">getDecisions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The decision is a dict, where the keys are the name of the</span>
<span class="sd">        socioeconomic variables, and the value are a boolean mentioning if</span>
<span class="sd">        it is active or not.</span>

<span class="sd">        :return: decision of activation of the socio-eco variables for</span>
<span class="sd">            the segmentation.</span>
<span class="sd">        :rtype: dict(str: bool)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">segmentation</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">segmentation</span><span class="o">.</span><span class="n">getDecisions</span><span class="p">()</span></div>

<div class="viewcode-block" id="term.setDecisions"><a class="viewcode-back" href="../../assisted.html#biogeme.assisted.term.setDecisions">[docs]</a>    <span class="k">def</span> <span class="nf">setDecisions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">decisions</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Implement the specification decisions, represented as a dict,</span>
<span class="sd">        where the keys are the name of the socioeconomic variables,</span>
<span class="sd">        and the value are a boolean mentioning if it is active or not.</span>

<span class="sd">        :param decisions: decision of activation of the socio-eco variables for</span>
<span class="sd">            the segmentation.</span>
<span class="sd">        :type decisions: dict(str: bool)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">segmentation</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">segmentation</span><span class="o">.</span><span class="n">setDecisions</span><span class="p">(</span><span class="n">decisions</span><span class="p">)</span></div>

<div class="viewcode-block" id="term.getBeta"><a class="viewcode-back" href="../../assisted.html#biogeme.assisted.term.getBeta">[docs]</a>    <span class="k">def</span> <span class="nf">getBeta</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">altname</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Obtain the name of the coefficient of the term</span>

<span class="sd">        :param altname: name of the alternative</span>
<span class="sd">        :type altname: str</span>

<span class="sd">        :return: name of the coefficient</span>
<span class="sd">        :rtype: str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">var</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;beta_</span><span class="si">{</span><span class="n">altname</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">generic</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;beta_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">genericName</span><span class="si">}</span><span class="s1">&#39;</span>

        <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;beta_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">altname</span><span class="si">}</span><span class="s1">&#39;</span></div>

<div class="viewcode-block" id="term.isValid"><a class="viewcode-back" href="../../assisted.html#biogeme.assisted.term.isValid">[docs]</a>    <span class="k">def</span> <span class="nf">isValid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">altname</span><span class="p">,</span> <span class="n">estimationResults</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check the validity of the estimated coefficient</span>

<span class="sd">        :param altname: name of the laternative</span>
<span class="sd">        :type altname: str</span>

<span class="sd">        :param estimationResults: results of the estimation with Biogeme</span>
<span class="sd">        :type estimationResults: :class:`biogeme.results.bioResults`</span>

<span class="sd">        :return: True if the valus is valid, False otherwise.</span>
<span class="sd">        :rtype: bool</span>

<span class="sd">        :raise biogemeError: if the parameter has not be estimated.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">validity</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">active</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">None</span>
        <span class="n">estimatedValues</span> <span class="o">=</span> <span class="n">estimationResults</span><span class="o">.</span><span class="n">getBetaValues</span><span class="p">()</span>
        <span class="n">status_msg</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">the_beta</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">coef_names</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Check validity of </span><span class="si">{</span><span class="n">the_beta</span><span class="si">=}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">val</span> <span class="o">=</span> <span class="n">estimatedValues</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">the_beta</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">val</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">p</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">estimatedValues</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
                <span class="k">raise</span> <span class="n">excep</span><span class="o">.</span><span class="n">biogemeError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s1">&#39;Parameter </span><span class="si">{</span><span class="n">b</span><span class="si">}</span><span class="s1">&#39;</span>
                    <span class="sa">f</span><span class="s1">&#39; has not been estimated. &#39;</span>
                    <span class="sa">f</span><span class="s1">&#39;Estimated parameters: &#39;</span>
                    <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">p</span><span class="si">}</span><span class="s1">&#39;</span>
                <span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">validity</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">status_msg</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">status_msg</span> <span class="o">=</span> <span class="s1">&#39;Invalid parameter(s):&#39;</span>
                <span class="n">status_msg</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39; </span><span class="si">{</span><span class="n">the_beta</span><span class="si">}</span><span class="s1"> in alternative </span><span class="si">{</span><span class="n">altname</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">val</span><span class="si">}</span><span class="s1">&#39;</span>

        <span class="k">return</span> <span class="n">status_msg</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">,</span> <span class="n">status_msg</span></div>

<div class="viewcode-block" id="term.getExpression"><a class="viewcode-back" href="../../assisted.html#biogeme.assisted.term.getExpression">[docs]</a>    <span class="k">def</span> <span class="nf">getExpression</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">altname</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Build the Biogeme expression for the term</span>

<span class="sd">        :param altname: name of the alternative</span>
<span class="sd">        :type altname: str</span>

<span class="sd">        :return: eypression for the term</span>
<span class="sd">        :rtype: :class:`biogeme.expressions.Expression`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">var</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">coef_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getBeta</span><span class="p">(</span><span class="n">altname</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">segmentation</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">Beta</span><span class="p">(</span><span class="n">coef_name</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">coef_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">coef_name</span><span class="p">]</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">segmentation</span><span class="o">.</span><span class="n">getExpression</span><span class="p">(</span><span class="n">coef_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bounds</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">active</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">coef_names</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="n">coef_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getBeta</span><span class="p">(</span><span class="n">altname</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">segmentation</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">coef_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">coef_name</span><span class="p">]</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">getExpression</span><span class="p">()</span> <span class="o">*</span> <span class="n">Beta</span><span class="p">(</span>
                <span class="n">coef_name</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">0</span>
            <span class="p">)</span>

        <span class="n">theBeta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">segmentation</span><span class="o">.</span><span class="n">getExpression</span><span class="p">(</span><span class="n">coef_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bounds</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coef_names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">theBeta</span><span class="o">.</span><span class="n">setOfBetas</span><span class="p">())</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">getExpression</span><span class="p">()</span> <span class="o">*</span> <span class="n">theBeta</span></div>

<div class="viewcode-block" id="term.describe"><a class="viewcode-back" href="../../assisted.html#biogeme.assisted.term.describe">[docs]</a>    <span class="k">def</span> <span class="nf">describe</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Provides a short description of the term.</span>

<span class="sd">        :return: short description.</span>
<span class="sd">        :rtype: str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">var</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="s1">&#39;Cte.&#39;</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">active</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">segmentation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">+=</span> <span class="s1">&#39; &#39;</span>
            <span class="n">result</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">segmentation</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">result</span></div></div>


<div class="viewcode-block" id="utility"><a class="viewcode-back" href="../../assisted.html#biogeme.assisted.utility">[docs]</a><span class="k">class</span> <span class="nc">utility</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Class representing the possible specifications of a utility function&quot;&quot;&quot;</span>

<div class="viewcode-block" id="utility.__init__"><a class="viewcode-back" href="../../assisted.html#biogeme.assisted.utility.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">alternativeId</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">terms</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Ctor.</span>

<span class="sd">        :param alternativeId: id of the alternative.</span>
<span class="sd">        :type alternativeId: int</span>

<span class="sd">        :param name: name of the alternative</span>
<span class="sd">        :type name: str</span>

<span class="sd">        :param terms: terms of the utility function.</span>
<span class="sd">        :type terms: list(term)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>  <span class="c1">#: name of the alternative</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">alternativeId</span>  <span class="c1">#: id of the alternative</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">terms</span> <span class="o">=</span> <span class="n">terms</span>  <span class="c1">#: list of terms in the utility function</span></div>

<div class="viewcode-block" id="utility.getExpression"><a class="viewcode-back" href="../../assisted.html#biogeme.assisted.utility.getExpression">[docs]</a>    <span class="k">def</span> <span class="nf">getExpression</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Obtain the Biogeme expression for the utility function.</span>

<span class="sd">        :return: Biogeme expression</span>
<span class="sd">        :rtype: :class:`biogeme.expressions.Expression`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">theTerms</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">t</span><span class="o">.</span><span class="n">getExpression</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">terms</span>
            <span class="k">if</span> <span class="n">t</span><span class="o">.</span><span class="n">getExpression</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="p">]</span>
        <span class="k">return</span> <span class="n">bioMultSum</span><span class="p">(</span><span class="n">theTerms</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="socioEconomic"><a class="viewcode-back" href="../../assisted.html#biogeme.assisted.socioEconomic">[docs]</a><span class="k">class</span> <span class="nc">socioEconomic</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Class representing  socio-economic characteristic&quot;&quot;&quot;</span>

<div class="viewcode-block" id="socioEconomic.__init__"><a class="viewcode-back" href="../../assisted.html#biogeme.assisted.socioEconomic.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">expression</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Ctor</span>

<span class="sd">        :param name: name of the segmentation variable</span>
<span class="sd">        :type name: str</span>

<span class="sd">        :param expression: Biogeme expression of the variable</span>
<span class="sd">        :type expression: meth:`biogeme.expressions.Expression`</span>

<span class="sd">        :param values: dict with values that it can take as keys, and a name</span>
<span class="sd">            describing them as values.</span>
<span class="sd">        :type values: dict(int: str)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>  <span class="c1">#: name of the segmentation variable</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">expression</span> <span class="o">=</span> <span class="n">expression</span>  <span class="c1">#: Biogeme expression of the variable</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">values</span> <span class="o">=</span> <span class="n">values</span>
        <span class="sd">&quot;&quot;&quot;dict with values that it can take as keys, and a name</span>
<span class="sd">        describing them as values.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">active</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1">#: True if the segmentation variable is active.</span></div>

<div class="viewcode-block" id="socioEconomic.combine"><a class="viewcode-back" href="../../assisted.html#biogeme.assisted.socioEconomic.combine">[docs]</a>    <span class="k">def</span> <span class="nf">combine</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">existingValues</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Generates the possible combinations of values,</span>
<span class="sd">        corresponding to segments.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">existingValues</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span>
                <span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">expression</span><span class="p">],</span> <span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="p">[</span><span class="n">v</span><span class="p">])</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="p">]</span>

        <span class="n">combination</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">triplet</span> <span class="ow">in</span> <span class="n">existingValues</span><span class="p">:</span>
                <span class="n">combination</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="p">(</span>
                        <span class="n">triplet</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">expression</span><span class="p">],</span>
                        <span class="n">triplet</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">k</span><span class="p">],</span>
                        <span class="n">triplet</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">v</span><span class="p">],</span>
                    <span class="p">)</span>
                <span class="p">)</span>
        <span class="k">return</span> <span class="n">combination</span></div></div>


<div class="viewcode-block" id="segmentation"><a class="viewcode-back" href="../../assisted.html#biogeme.assisted.segmentation">[docs]</a><span class="k">class</span> <span class="nc">segmentation</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Class representing the possible segmentations&quot;&quot;&quot;</span>

<div class="viewcode-block" id="segmentation.__init__"><a class="viewcode-back" href="../../assisted.html#biogeme.assisted.segmentation.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">dictOfSocioEco</span><span class="p">,</span> <span class="n">combinatorial</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Ctor</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dictOfSocioEco</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">k</span><span class="p">:</span> <span class="n">socioEconomic</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">dictOfSocioEco</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="p">}</span>
        <span class="sd">&quot;&quot;&quot;dict of object of class socioEconomic characterizing the</span>
<span class="sd">        segmentation.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">combinatorial</span> <span class="o">=</span> <span class="n">combinatorial</span>
        <span class="sd">&quot;&quot;&quot;True if all combinations are considered&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">listOfVariables</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1">#: list of variables involved</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">alwaysActive</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1">#: True if it must always be active</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>  <span class="c1">#: name of the segmentation</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">used</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1">#: True if used.</span></div>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">dictOfSocioEco</span><span class="si">}</span><span class="s1">&#39;</span>

<div class="viewcode-block" id="segmentation.getDecisions"><a class="viewcode-back" href="../../assisted.html#biogeme.assisted.segmentation.getDecisions">[docs]</a>    <span class="k">def</span> <span class="nf">getDecisions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The decision is a dict, where the keys are the name of the</span>
<span class="sd">        socioeconomic variables, and the value are a boolean mentioning</span>
<span class="sd">        if it is active or not.</span>

<span class="sd">        :return: decision of activation of the socio-eco variables for</span>
<span class="sd">            the segmentation.</span>
<span class="sd">        :rtype: dict(str: bool)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">decision</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span><span class="o">.</span><span class="n">active</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dictOfSocioEco</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
        <span class="k">return</span> <span class="n">decision</span></div>

<div class="viewcode-block" id="segmentation.setDecisions"><a class="viewcode-back" href="../../assisted.html#biogeme.assisted.segmentation.setDecisions">[docs]</a>    <span class="k">def</span> <span class="nf">setDecisions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">decisions</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Implement the specification decisions, represented as a dict,</span>
<span class="sd">        where the keys are the name of the socioeconomic variables,</span>
<span class="sd">        and the value are a boolean mentioning if it is active or not.</span>

<span class="sd">        :param decisions: decision of activation of the socio-eco variables for</span>
<span class="sd">            the segmentation.</span>
<span class="sd">        :type decisions: dict(str: bool)</span>

<span class="sd">        :raise biogemeError: if the name of a segmentation is unknown</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">decisions</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dictOfSocioEco</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">active</span> <span class="o">=</span> <span class="n">v</span>
            <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">error_msg</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="sa">f</span><span class="s1">&#39;Key </span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s1"> is unknown. &#39;</span>
                    <span class="sa">f</span><span class="s1">&#39;Available segmentations: &#39;</span>
                    <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dictOfSocioEco</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="si">}</span><span class="s1">&#39;</span>
                <span class="p">)</span>
                <span class="k">raise</span> <span class="n">excep</span><span class="o">.</span><span class="n">biogemeError</span><span class="p">(</span><span class="n">error_msg</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span></div>

<div class="viewcode-block" id="segmentation.isActive"><a class="viewcode-back" href="../../assisted.html#biogeme.assisted.segmentation.isActive">[docs]</a>    <span class="k">def</span> <span class="nf">isActive</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Check if there are active variables for this segmentation.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">alwaysActive</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="n">activeVariables</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span>
            <span class="n">v</span><span class="o">.</span><span class="n">active</span> <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">True</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">listOfVariables</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">activeVariables</span> <span class="o">&gt;</span> <span class="mi">0</span></div>

<div class="viewcode-block" id="segmentation.getBetaNames"><a class="viewcode-back" href="../../assisted.html#biogeme.assisted.segmentation.getBetaNames">[docs]</a>    <span class="k">def</span> <span class="nf">getBetaNames</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coef_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the name of the parameters for all combinations.&quot;&quot;&quot;</span>

        <span class="n">expr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getExpression</span><span class="p">(</span><span class="n">coef_name</span><span class="p">,</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
        <span class="n">betas</span> <span class="o">=</span> <span class="n">expr</span><span class="o">.</span><span class="n">setOfBetas</span><span class="p">()</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">betas</span><span class="p">]</span>
        <span class="n">combinations</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dictOfSocioEco</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">v</span><span class="o">.</span><span class="n">active</span><span class="p">:</span>
                <span class="n">combinations</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">combine</span><span class="p">(</span><span class="n">combinations</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">combinations</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">coef_name</span><span class="p">]</span>

        <span class="n">betas</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">triplet</span> <span class="ow">in</span> <span class="n">combinations</span><span class="p">:</span>
            <span class="n">theCoefName</span> <span class="o">=</span> <span class="n">coef_name</span>
            <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">triplet</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">triplet</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">triplet</span><span class="p">[</span><span class="mi">2</span><span class="p">]):</span>
                <span class="n">theCoefName</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">theCoefName</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">&#39;</span>
            <span class="n">betas</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">theCoefName</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">betas</span></div>

<div class="viewcode-block" id="segmentation.getExpression"><a class="viewcode-back" href="../../assisted.html#biogeme.assisted.segmentation.getExpression">[docs]</a>    <span class="k">def</span> <span class="nf">getExpression</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coef_name</span><span class="p">,</span> <span class="n">bounds</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Obtain the Biogeme expression.</span>

<span class="sd">        :param coef_name: name of the coefficient</span>
<span class="sd">        :type coef_name: str</span>

<span class="sd">        :param bounds: bounds on the coefficient</span>
<span class="sd">        :type bounds: tuple(float, float)</span>

<span class="sd">        :return: biogeme  expression for the segmentation</span>
<span class="sd">        :rtype: :class:`biogeme.expressions.bioMultSum`</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1">#        combinations = None</span>
        <span class="c1">#        for v in self.dictOfSocioEco.values():</span>
        <span class="c1">#            if v.active:</span>
        <span class="c1">#                combinations = v.combine(combinations)</span>
        <span class="c1">#</span>
        <span class="c1">#        if combinations is None:</span>
        <span class="c1">#            return Beta(coef_name, 0, bounds[0], bounds[1], 0)</span>
        <span class="c1">#</span>
        <span class="c1">#        listOfTerms = []</span>
        <span class="c1">#        for triplet in combinations:</span>
        <span class="c1">#            theCoefName = coef_name</span>
        <span class="c1">#            listOfConditions = []</span>
        <span class="c1">#            for var, value, name in zip(triplet[0], triplet[1], triplet[2]):</span>
        <span class="c1">#                theCoefName = f&#39;{theCoefName}_{name}&#39;</span>
        <span class="c1">#                listOfConditions.append(var == value)</span>
        <span class="c1">#            aTerm = Beta(theCoefName, 0, bounds[0], bounds[1], 0)</span>
        <span class="c1">#            for t in listOfConditions:</span>
        <span class="c1">#                aTerm = aTerm * t</span>
        <span class="c1">#            listOfTerms.append(aTerm)</span>
        <span class="c1">#        before =  bioMultSum(listOfTerms)</span>

        <span class="n">the_coef</span> <span class="o">=</span> <span class="n">Beta</span><span class="p">(</span><span class="n">coef_name</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">list_of_segmentations</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">DiscreteSegmentationTuple</span><span class="p">(</span><span class="n">variable</span><span class="o">=</span><span class="n">v</span><span class="o">.</span><span class="n">expression</span><span class="p">,</span> <span class="n">mapping</span><span class="o">=</span><span class="n">v</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dictOfSocioEco</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">v</span><span class="o">.</span><span class="n">active</span>
        <span class="p">]</span>
        <span class="k">return</span> <span class="n">segment_parameter</span><span class="p">(</span>
            <span class="n">the_coef</span><span class="p">,</span> <span class="n">list_of_segmentations</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">combinatorial</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="segmentation.describe"><a class="viewcode-back" href="../../assisted.html#biogeme.assisted.segmentation.describe">[docs]</a>    <span class="k">def</span> <span class="nf">describe</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Description of the segmentation</span>

<span class="sd">        :return: description</span>
<span class="sd">        :rtype: str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">active</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dictOfSocioEco</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">if</span> <span class="n">t</span><span class="o">.</span><span class="n">active</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">active</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;&lt;&#39;</span> <span class="o">+</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">active</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;&gt;&#39;</span>
        <span class="k">return</span> <span class="s1">&#39;&#39;</span></div></div>


<div class="viewcode-block" id="specificationProblem"><a class="viewcode-back" href="../../assisted.html#biogeme.assisted.specificationProblem">[docs]</a><span class="k">class</span> <span class="nc">specificationProblem</span><span class="p">(</span><span class="n">vns</span><span class="o">.</span><span class="n">problemClass</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Class defining the choice model specification problem&quot;&quot;&quot;</span>

<div class="viewcode-block" id="specificationProblem.__init__"><a class="viewcode-back" href="../../assisted.html#biogeme.assisted.specificationProblem.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">name</span><span class="p">,</span>
        <span class="n">database</span><span class="p">,</span>
        <span class="n">theVariables</span><span class="p">,</span>
        <span class="n">theGroups</span><span class="p">,</span>
        <span class="n">genericForbiden</span><span class="p">,</span>
        <span class="n">forceActive</span><span class="p">,</span>
        <span class="n">theNonlinearSpecs</span><span class="p">,</span>
        <span class="n">theSegmentations</span><span class="p">,</span>
        <span class="n">utilities</span><span class="p">,</span>
        <span class="n">availabilities</span><span class="p">,</span>
        <span class="n">choice</span><span class="p">,</span>
        <span class="n">models</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Ctor.</span>

<span class="sd">        :param name: name of the problem.</span>
<span class="sd">        :type name: str</span>

<span class="sd">        :param database: data for the estimation</span>
<span class="sd">        :type database: :class:`biogeme.database.Database`</span>

<span class="sd">        :param theVariables: variables involved in the model and their names</span>
<span class="sd">        :type theVariables: dict(str: :class:`biogeme.expressions.Expression`)</span>

<span class="sd">        :param theGroups: variables in the same groups share the same</span>
<span class="sd">            transforms and activation status. Each group is characterized</span>
<span class="sd">            by its name, and is associated to a list of variables,</span>
<span class="sd">            identified by their name.</span>
<span class="sd">        :type theGroups: dict(str: list(str))</span>

<span class="sd">        :param genericForbiden: groups of variables that must be</span>
<span class="sd">            alternative specific.</span>

<span class="sd">        :type genericForbiden: list(str)</span>

<span class="sd">        :param forceActive: groups of variables that must be in the model.</span>
<span class="sd">        :type forceActive: list(str)</span>

<span class="sd">        :param theNonlinearSpecs: associates a group of variables or a</span>
<span class="sd">            variable with a list of possible nonlinear</span>
<span class="sd">            transformations. Each transformation is a function that takes</span>
<span class="sd">            one argument (the variable), and return a tuple with</span>

<span class="sd">            - the name of the nonlinear transform</span>
<span class="sd">            - the expression of the transform.</span>

<span class="sd">             Examples of such a function::</span>

<span class="sd">                def sqrt(x):</span>
<span class="sd">                    return &#39;sqrt&#39;, x**0.5</span>

<span class="sd">                def boxcox(x):</span>
<span class="sd">                    ell = Beta(f&#39;lambda&#39;, 1, 0.0001, 3.0, 0)</span>
<span class="sd">                    return &#39;Box-Cox&#39;, models.boxcox(x, ell)</span>

<span class="sd">        :type theNonlinearSpecs: dict(str: list( fct() ))</span>


<span class="sd">        :param theSegmentations: a dictionary, with keys being names</span>
<span class="sd">            and values beeing tuples (var, segments), where</span>

<span class="sd">            - var is the name of the variable</span>
<span class="sd">            - segments is a dict with keys being the value of the variable</span>
<span class="sd">              characterizing a segment, and the value being the name of</span>
<span class="sd">              the segment.</span>

<span class="sd">            Example::</span>

<span class="sd">                {&#39;Income&#39;: (Income, {1: &#39;&lt;2500&#39;,</span>
<span class="sd">                                     2: &#39;2051_4000&#39;,</span>
<span class="sd">                                     3: &#39;4001_6000&#39;,</span>
<span class="sd">                                     4: &#39;6001_8000&#39;,</span>
<span class="sd">                                     5: &#39;8001_10000&#39;,</span>
<span class="sd">                                     6: &#39;&gt;10000&#39;,</span>
<span class="sd">                                     -1: &#39;unknown&#39;}),</span>
<span class="sd">                 &#39;Gender&#39;: (Gender, {1: &#39;male&#39;,</span>
<span class="sd">                                     2: &#39;female&#39;,</span>
<span class="sd">                                    -1: &#39;unkown&#39;}),</span>

<span class="sd">        :type theSegmentations: dict(str, tuple(biogeme.expression.Expression,</span>
<span class="sd">                                                dict(int, str)))</span>

<span class="sd">        :param utilities: specification of the utility functions. It</span>
<span class="sd">            is a dict where</span>

<span class="sd">            - the keys are the ID of the alternatives.</span>

<span class="sd">            - the values are a tuple containing the name of the</span>
<span class="sd">              alternative and the specification.</span>

<span class="sd">            The specification is a list of terms. A term is a tuple with</span>
<span class="sd">            the name of the variable, the name of the segmentation, the</span>
<span class="sd">            bounds on the coeffcient, and a function checking the validity</span>
<span class="sd">            of the corresponding parameter (typically, check its</span>
<span class="sd">            sign). All can be None. If they are all None, it corresponds</span>
<span class="sd">            to the alternative specification constant, without any</span>
<span class="sd">            segmentation and any assumption on the sign.</span>

<span class="sd">            Example::</span>

<span class="sd">                utility_pt = [(&#39;PT cte&#39;, &#39;Seg. cte&#39;, (None, None), None),</span>
<span class="sd">                  (&#39;PT travel time&#39;, &#39;Seg. time&#39;, (None, 0), None),</span>
<span class="sd">                  (&#39;PT travel cost&#39;, &#39;Seg. PT cost&#39;, (None, None), isNegative),</span>
<span class="sd">                  (&#39;PT Waiting time&#39;, &#39;Seg. wait&#39;, (None, 0), None)]</span>


<span class="sd">                utility_car = [(&#39;Car cte&#39;, &#39;Seg. cte&#39;, (None, None), None),</span>
<span class="sd">                  (&#39;Car travel time&#39;, &#39;Seg. time&#39;, (None, 0), None),</span>
<span class="sd">                  (</span>
<span class="sd">                   &#39;Car travel cost&#39;,</span>
<span class="sd">                   &#39;Seg. car cost&#39;,</span>
<span class="sd">                   (None, None),</span>
<span class="sd">                   isNegative</span>
<span class="sd">                  ),</span>
<span class="sd">                  (&#39;Nbr of cars&#39;, &#39;Seg nbr cars&#39;, (None, None), None)]</span>

<span class="sd">                utility_sm = [(</span>
<span class="sd">                               &#39;Distance&#39;,</span>
<span class="sd">                               &#39;Seg. dist&#39;,</span>
<span class="sd">                               (None, None),</span>
<span class="sd">                               isNegative</span>
<span class="sd">                              )]</span>

<span class="sd">                choiceModel = {0: (&#39;pt&#39;, utility_pt),</span>
<span class="sd">                               1: (&#39;car&#39;, utility_car),</span>
<span class="sd">                               2: (&#39;sm&#39;, utility_sm)}</span>

<span class="sd">        :type utilities: dict(int, tuple(str,</span>
<span class="sd">                         list(tuple(str, str, tuple(float, float),function))))</span>

<span class="sd">        :param availabilities: dict describing the availability of the</span>
<span class="sd">            alternatives.</span>

<span class="sd">        :type availabilities:</span>
<span class="sd">            dict(int, :class:`biogeme.expressions.Expression`)</span>

<span class="sd">        :param choice: expression for the observed choice</span>
<span class="sd">        :type choice: :class:`biogeme.expressions.Expression`</span>

<span class="sd">        :param models: dict of possible models. A model is a function</span>
<span class="sd">            that takes the utilities and the availabilities, and return</span>
<span class="sd">            the loglikelihood expression.</span>

<span class="sd">        :type models: dict(str, fct)</span>

<span class="sd">        :raise biogemeError: if a variable is found in two different groups.</span>

<span class="sd">        :raise biogemeError: if the list of groups forbiden to be</span>
<span class="sd">            active contains an unknown group.</span>

<span class="sd">        :raise biogemeError: if the list of groups forced to be active</span>
<span class="sd">            contains an unknown group.</span>

<span class="sd">        :raise biogemeError: if some variables are not in any group.</span>

<span class="sd">        :raise biogemeError: if a segmentation in a utility function is</span>
<span class="sd">            unknown.</span>

<span class="sd">        :raise biogemeError: if a variable in a utility function is unknown.</span>

<span class="sd">        :raise biogemeError: if some variables are not used.</span>



<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">archive</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="sd">&quot;&quot;&quot;Dictionary, where the keys are solutions (objects of type</span>
<span class="sd">        :class:`biogeme.vns.solutionClass`) and the values are the</span>
<span class="sd">        estimation results (objects of type</span>
<span class="sd">        :class:`biogeme.results.bioResults`).</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>  <span class="c1">#: name of the problem.</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">database</span> <span class="o">=</span> <span class="n">database</span>
        <span class="sd">&quot;&quot;&quot;object of type :class:`biogeme.database.Database`, containing the</span>
<span class="sd">        data.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># First check if all the variables are in a group. For those</span>
        <span class="c1"># who are not, create a group with a single variable</span>
        <span class="n">groupForVar</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">theVariables</span><span class="p">}</span>
        <span class="k">for</span> <span class="n">group</span><span class="p">,</span> <span class="n">listOfVars</span> <span class="ow">in</span> <span class="n">theGroups</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">listOfVars</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">groupForVar</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">groupForVar</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="n">group</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">error_msg</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="sa">f</span><span class="s1">&#39;Var </span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s1"> cannot be both in group </span><span class="si">{</span><span class="n">group</span><span class="si">}</span><span class="s1">&#39;</span>
                        <span class="sa">f</span><span class="s1">&#39; and group </span><span class="si">{</span><span class="n">groupForVar</span><span class="p">[</span><span class="n">x</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span>
                    <span class="p">)</span>
                    <span class="k">raise</span> <span class="n">excep</span><span class="o">.</span><span class="n">biogemeError</span><span class="p">(</span><span class="n">error_msg</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">groupForVar</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">g</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">detailed</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Variable </span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s1"> is alone in a group.&#39;</span><span class="p">)</span>
                <span class="n">theGroups</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">theVariables</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">k</span><span class="p">:</span> <span class="n">variable</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">theVariables</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="p">}</span>
        <span class="sd">&quot;&quot;&quot;dict of variables, where the keys are the names, and the values are</span>
<span class="sd">        objects of class ``variable``</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">theGroups</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">k</span><span class="p">:</span> <span class="n">groupOfVariables</span><span class="p">(</span>
                <span class="n">k</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">theVariables</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">v</span><span class="p">],</span> <span class="n">theNonlinearSpecs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">theGroups</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="p">}</span>
        <span class="sd">&quot;&quot;&quot;dict of groups of variables, where the keys are the names, and the</span>
<span class="sd">        values are objects of class ``groupOfVariables``</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">genericForbiden</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">genericForbiden</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">theGroups</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">forbidGeneric</span><span class="p">()</span>
                <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="n">error_msg</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="sa">f</span><span class="s1">&#39;Unknown group of variables </span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s1"> &#39;</span>
                        <span class="sa">f</span><span class="s1">&#39;in the list </span><span class="si">{</span><span class="n">genericForbiden</span><span class="si">}</span><span class="s1">&#39;</span>
                    <span class="p">)</span>
                    <span class="k">raise</span> <span class="n">excep</span><span class="o">.</span><span class="n">biogemeError</span><span class="p">(</span><span class="n">error_msg</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>

        <span class="k">if</span> <span class="n">forceActive</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">forceActive</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">theGroups</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">forceActive</span><span class="p">()</span>
                <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="n">error_msg</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="sa">f</span><span class="s1">&#39;Unknown group of variables </span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s1"> &#39;</span>
                        <span class="sa">f</span><span class="s1">&#39;in the list </span><span class="si">{</span><span class="n">forceActive</span><span class="si">}</span><span class="s1">&#39;</span>
                    <span class="p">)</span>
                    <span class="k">raise</span> <span class="n">excep</span><span class="o">.</span><span class="n">biogemeError</span><span class="p">(</span><span class="n">error_msg</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>

        <span class="n">check</span> <span class="o">=</span> <span class="p">{</span><span class="n">v</span><span class="p">:</span> <span class="kc">False</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">theVariables</span><span class="p">}</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">myvars</span> <span class="ow">in</span> <span class="n">theGroups</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">myvars</span><span class="p">:</span>
                <span class="n">check</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">check</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">c</span><span class="p">:</span>
                <span class="n">error_msg</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="sa">f</span><span class="s1">&#39;Variables not in any group: &#39;</span>
                    <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">check</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">c</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span>
                <span class="p">)</span>
                <span class="k">raise</span> <span class="n">excep</span><span class="o">.</span><span class="n">biogemeError</span><span class="p">(</span><span class="n">error_msg</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">theSegmentations</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">k</span><span class="p">:</span> <span class="n">segmentation</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="o">.</span><span class="n">dict</span><span class="p">,</span> <span class="n">v</span><span class="o">.</span><span class="n">combinatorial</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">theSegmentations</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="p">}</span>
        <span class="sd">&quot;&quot;&quot;dict of segmentations, where the keys are the names, and the</span>
<span class="sd">        values are objects of class ``segmentation``</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">utilities</span> <span class="o">=</span> <span class="n">utilities</span>
        <span class="sd">&quot;&quot;&quot;specification of the utility functions. See</span>
<span class="sd">        :class:`biogeme.assisted.specificationProblem.__init__`</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">choice</span> <span class="o">=</span> <span class="n">choice</span>  <span class="c1">#: expression for the observed choice</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">availability</span> <span class="o">=</span> <span class="n">availabilities</span>
        <span class="sd">&quot;&quot;&quot;dict describing the availability of the alternatives.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">theAlternatives</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="sd">&quot;&quot;&quot;Dict of utility functions, where the keys are the id of the</span>
<span class="sd">        alternatives, and the values are objects of type</span>
<span class="sd">        :class:`biogeme.assisted.utility`</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># self.models = [(k, v) for k, v in models.items()]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">models</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
        <span class="sd">&quot;&quot;&quot; List tuple (name, model).  A model is a function</span>
<span class="sd">        that takes the utilities and the availabilities, and return</span>
<span class="sd">        the loglikelihood expression.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">selectedModel</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1">#: index of the selected model</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">maximumNumberOfParameters</span> <span class="o">=</span> <span class="mi">200</span>
        <span class="sd">&quot;&quot;&quot;maximum number of parameters allowed in a specification. If the</span>
<span class="sd">        current model has more parameters, it is declared invalid and</span>
<span class="sd">        rejected by the algorithm.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">lastOperator</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1">#: Last operator used</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">operators</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;Change segmentation&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">changeSegmentation</span><span class="p">,</span>
            <span class="s1">&#39;Increase segmentation&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">increaseSegmentation</span><span class="p">,</span>
            <span class="s1">&#39;Decrease segmentation&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">decreaseSegmentation</span><span class="p">,</span>
            <span class="s1">&#39;Change linearity&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">changeLinearity</span><span class="p">,</span>
            <span class="s1">&#39;Change variables&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">changeVariables</span><span class="p">,</span>
            <span class="s1">&#39;Change generic&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">changeGeneric</span><span class="p">,</span>
            <span class="s1">&#39;Change nonlinearity&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">changeNonlinearity</span><span class="p">,</span>
            <span class="s1">&#39;Change model&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">changeModel</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="sd">&quot;&quot;&quot;Dict of operators, where the keys are the names, and the values are</span>
<span class="sd">        the function imple,enting the operators.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">operatorsManagement</span> <span class="o">=</span> <span class="n">vns</span><span class="o">.</span><span class="n">operatorsManagement</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">operators</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="sd">&quot;&quot;&quot; Object of type :class:`biogeme.vns.operatorsManagement`</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Check the consistency of the input</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">u</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">utilities</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="c1"># First check that the tuples have the correct length</span>
            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">u</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">4</span><span class="p">:</span>
                    <span class="n">err_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;tuple must contain 4 elements: </span><span class="si">{</span><span class="n">t</span><span class="si">}</span><span class="s1">&#39;</span>
                    <span class="k">raise</span> <span class="n">excep</span><span class="o">.</span><span class="n">biogemeError</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
            <span class="c1"># All segmentations must exist</span>
            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">u</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="c1"># t[0] name of the attribute</span>
                <span class="c1"># t[1] name of the segmentation</span>
                <span class="c1"># t[2] bounds</span>
                <span class="c1"># t[3] function checking validity</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="n">t</span><span class="o">.</span><span class="n">segmentation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                    <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">theSegmentations</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">segmentation</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span>
                <span class="p">):</span>
                    <span class="k">raise</span> <span class="n">excep</span><span class="o">.</span><span class="n">biogemeError</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s1">&#39;Segmentation </span><span class="si">{</span><span class="n">t</span><span class="o">.</span><span class="n">segmentation</span><span class="si">}</span><span class="s1"> &#39;</span> <span class="sa">f</span><span class="s1">&#39;does not exist&#39;</span>
                    <span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="n">t</span><span class="o">.</span><span class="n">attribute</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                    <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">theVariables</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">attribute</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span>
                <span class="p">):</span>
                    <span class="k">raise</span> <span class="n">excep</span><span class="o">.</span><span class="n">biogemeError</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s1">&#39;Attribute </span><span class="si">{</span><span class="n">t</span><span class="o">.</span><span class="n">attribute</span><span class="si">}</span><span class="s1"> does not exist&#39;</span>
                    <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">theAlternatives</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">utility</span><span class="p">(</span>
                    <span class="n">k</span><span class="p">,</span>
                    <span class="n">u</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                    <span class="p">[</span>
                        <span class="n">term</span><span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">theVariables</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">tt</span><span class="o">.</span><span class="n">attribute</span><span class="p">),</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">theSegmentations</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">tt</span><span class="o">.</span><span class="n">segmentation</span><span class="p">),</span>
                            <span class="n">tt</span><span class="o">.</span><span class="n">bounds</span><span class="p">,</span>
                            <span class="n">tt</span><span class="o">.</span><span class="n">validity</span><span class="p">,</span>
                        <span class="p">)</span>
                        <span class="k">for</span> <span class="n">tt</span> <span class="ow">in</span> <span class="n">u</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="p">],</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">t</span><span class="o">.</span><span class="n">segmentation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">theSegmentations</span><span class="p">[</span>
                        <span class="n">t</span><span class="o">.</span><span class="n">segmentation</span>
                    <span class="p">]</span><span class="o">.</span><span class="n">listOfVariables</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">theVariables</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">attribute</span><span class="p">)</span>
                    <span class="p">)</span>
                <span class="c1"># If the segmentation is not associated with a</span>
                <span class="c1"># variable, it must always be active</span>
                <span class="k">if</span> <span class="n">t</span><span class="o">.</span><span class="n">attribute</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">theSegmentations</span><span class="p">[</span><span class="n">t</span><span class="o">.</span><span class="n">segmentation</span><span class="p">]</span><span class="o">.</span><span class="n">alwaysActive</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">decisions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getDecisions</span><span class="p">()</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The decisions consist of:</span>

<span class="sd">        - a dict of decisions for each group of variables.</span>
<span class="sd">        - for each utility, a list of decisions for each term.</span>
<span class="sd">        - the selected model</span>

<span class="sd">        Type: tuple(dict(str: int), dict(str: list(dict(str: bool))), int)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">unused</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">theVariables</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">v</span><span class="o">.</span><span class="n">used</span><span class="p">:</span>
                <span class="n">unused</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">unused</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">excep</span><span class="o">.</span><span class="n">biogemeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;The following variables &#39;</span> <span class="sa">f</span><span class="s1">&#39;are not used: </span><span class="si">{</span><span class="n">unused</span><span class="si">}</span><span class="s1">&#39;</span>
            <span class="p">)</span>
        <span class="n">unused</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">theSegmentations</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">s</span><span class="o">.</span><span class="n">used</span><span class="p">:</span>
                <span class="n">unused</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">unused</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">excep</span><span class="o">.</span><span class="n">biogemeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;The following segmentations &#39;</span> <span class="sa">f</span><span class="s1">&#39;are not used: </span><span class="si">{</span><span class="n">unused</span><span class="si">}</span><span class="s1">&#39;</span>
            <span class="p">)</span></div>

<div class="viewcode-block" id="specificationProblem.getBiogemeModel"><a class="viewcode-back" href="../../assisted.html#biogeme.assisted.specificationProblem.getBiogemeModel">[docs]</a>    <span class="k">def</span> <span class="nf">getBiogemeModel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Build the Biogeme expressions of a given specification&quot;&quot;&quot;</span>
        <span class="n">V</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span><span class="o">.</span><span class="n">getExpression</span><span class="p">()</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">theAlternatives</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
        <span class="n">logprob</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">models</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">selectedModel</span><span class="p">][</span><span class="mi">1</span><span class="p">](</span>
            <span class="n">V</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">availability</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">choice</span>
        <span class="p">)</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">bio</span><span class="o">.</span><span class="n">BIOGEME</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="p">,</span>
            <span class="n">logprob</span><span class="p">,</span>
            <span class="n">suggestScales</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">userNotes</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">describeHtml</span><span class="p">(),</span>
        <span class="p">)</span>
        <span class="n">b</span><span class="o">.</span><span class="n">generateHtml</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">b</span><span class="o">.</span><span class="n">generatePickle</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="n">b</span></div>

<div class="viewcode-block" id="specificationProblem.getDecisions"><a class="viewcode-back" href="../../assisted.html#biogeme.assisted.specificationProblem.getDecisions">[docs]</a>    <span class="k">def</span> <span class="nf">getDecisions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The decisions consist of:</span>

<span class="sd">        - a dict of decisions for each group of variables.</span>
<span class="sd">        - for each utility, a list of decisions for each term.</span>
<span class="sd">        - the selected model</span>

<span class="sd">        :return: all decisions</span>
<span class="sd">        :rtype: tuple(dict(str: int), dict(str: list(dict(str: bool))), int)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">groupDecisions</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">k</span><span class="p">:</span> <span class="n">v</span><span class="o">.</span><span class="n">getDecisions</span><span class="p">()</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">theGroups</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="p">}</span>
        <span class="n">termDecisions</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">k</span><span class="p">:</span> <span class="p">[</span><span class="n">t</span><span class="o">.</span><span class="n">getDecisions</span><span class="p">()</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">u</span><span class="o">.</span><span class="n">terms</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">u</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">theAlternatives</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">groupDecisions</span><span class="p">,</span> <span class="n">termDecisions</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">selectedModel</span></div>

<div class="viewcode-block" id="specificationProblem.setDecisions"><a class="viewcode-back" href="../../assisted.html#biogeme.assisted.specificationProblem.setDecisions">[docs]</a>    <span class="k">def</span> <span class="nf">setDecisions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">decisions</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Implement the specification decisions</span>

<span class="sd">        :param decisions: specification decisions</span>
<span class="sd">        :type decisions: tuple(dict(str: int),</span>
<span class="sd">                               dict(str: list(dict(str: bool))),</span>
<span class="sd">                               int)</span>

<span class="sd">        :raise biogemeError: if a group of variables is unknown.</span>

<span class="sd">        :raise biogemeError: if an alternative is unknown.</span>

<span class="sd">        :raise biogemeError: if the length of decisions is</span>
<span class="sd">            inconsistent with the number of terms in the utility function.</span>

<span class="sd">        :raise biogemeError: if the njumber of the model is out of range.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">decisions</span> <span class="o">==</span> <span class="n">decisions</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">decisions</span> <span class="o">=</span> <span class="n">decisions</span>
        <span class="n">groupDecisions</span><span class="p">,</span> <span class="n">termDecisions</span><span class="p">,</span> <span class="n">modelDecision</span> <span class="o">=</span> <span class="n">decisions</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">groupDecisions</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">theGroups</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">g</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">excep</span><span class="o">.</span><span class="n">biogemeError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s1">&#39;Unknown group of variables </span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s1">. &#39;</span>
                    <span class="sa">f</span><span class="s1">&#39;Existing groups: &#39;</span>
                    <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theGroups</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="si">}</span><span class="s1">&#39;</span>
                <span class="p">)</span>
            <span class="n">g</span><span class="o">.</span><span class="n">setDecisions</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">termDecisions</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">u</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">theAlternatives</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">u</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">excep</span><span class="o">.</span><span class="n">biogemeError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s1">&#39;Unkown alternative </span><span class="si">{</span><span class="n">u</span><span class="si">}</span><span class="s1">. &#39;</span>
                    <span class="sa">f</span><span class="s1">&#39;Existing alternatives: &#39;</span>
                    <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">utilities</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="si">}</span><span class="s1">&#39;</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">terms</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">excep</span><span class="o">.</span><span class="n">biogemeError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s1">&#39;Utility of </span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s1"> has </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">terms</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span>
                    <span class="sa">f</span><span class="s1">&#39; terms and decisions are for &#39;</span>
                    <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="si">}</span><span class="s1"> terms&#39;</span>
                <span class="p">)</span>
            <span class="k">for</span> <span class="n">t</span><span class="p">,</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">terms</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
                <span class="n">t</span><span class="o">.</span><span class="n">setDecisions</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">modelDecision</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">modelDecision</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">models</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">excep</span><span class="o">.</span><span class="n">biogemeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;Invalid model number: </span><span class="si">{</span><span class="n">modelDecision</span><span class="si">}</span><span class="s1">.&#39;</span>
                <span class="sa">f</span><span class="s1">&#39; Must be between 0 and &#39;</span>
                <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">models</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="si">}</span><span class="s1">&#39;</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selectedModel</span> <span class="o">=</span> <span class="n">modelDecision</span></div>

<div class="viewcode-block" id="specificationProblem.reset"><a class="viewcode-back" href="../../assisted.html#biogeme.assisted.specificationProblem.reset">[docs]</a>    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Deasactivate variables from the model, that can be deactivated.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">theGroups</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">g</span><span class="o">.</span><span class="n">activate</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">seg</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">theSegmentations</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">decisions</span> <span class="o">=</span> <span class="n">seg</span><span class="o">.</span><span class="n">getDecisions</span><span class="p">()</span>
            <span class="n">decisions</span> <span class="o">=</span> <span class="p">{</span><span class="n">x</span><span class="p">:</span> <span class="kc">False</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">decisions</span><span class="p">}</span>
            <span class="n">seg</span><span class="o">.</span><span class="n">setDecisions</span><span class="p">(</span><span class="n">decisions</span><span class="p">)</span></div>

<div class="viewcode-block" id="specificationProblem.generateSolution"><a class="viewcode-back" href="../../assisted.html#biogeme.assisted.specificationProblem.generateSolution">[docs]</a>    <span class="k">def</span> <span class="nf">generateSolution</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nonlinearSpecs</span><span class="p">,</span> <span class="n">segmentations</span><span class="p">,</span> <span class="n">model</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Generate a solution for the VNS algorithm</span>

<span class="sd">        :param nonlinearSpecs: nonlinear specifications. It is a dictionary</span>
<span class="sd">            where</span>

<span class="sd">            - the keys correspond to groups of variables,</span>
<span class="sd">            - the values are tuple with two entries:</span>

<span class="sd">                - index in the list self.nonlinearSpecs corresponding to</span>
<span class="sd">                  the nonlinear spec, or None if linear,</span>
<span class="sd">                - a boolean that is True if the coefficient is generic,</span>
<span class="sd">                  False otherwise.</span>

<span class="sd">            Example::</span>

<span class="sd">                nl = {&#39;Travel time&#39;: (0, False),</span>
<span class="sd">                      &#39;Travel cost&#39;: (0, False),</span>
<span class="sd">                      &#39;Headway&#39;: (0, False)}</span>

<span class="sd">        :type nonlinearSpecs: dict(str: tuple(int, bool))</span>

<span class="sd">        :param segmentations: dictionary where the keys are the name</span>
<span class="sd">            of the segmentations, and the values are lists of</span>
<span class="sd">            socio-economic characteristics that must be activated.</span>

<span class="sd">            Example::</span>

<span class="sd">                sg = {&#39;Seg. cte&#39;: [&#39;GA&#39;],</span>
<span class="sd">                      &#39;Seg. cost&#39;: [&#39;class&#39;, &#39;who&#39;],</span>
<span class="sd">                      &#39;Seg. time&#39;: [&#39;gender&#39;],</span>
<span class="sd">                      &#39;Seg. headway&#39;: [&#39;class&#39;]}</span>
<span class="sd">        :type segmentations: dict(str: list(str))</span>

<span class="sd">        :param model: selected model</span>
<span class="sd">        :type model: str</span>

<span class="sd">        :return: the solution that has been generated</span>
<span class="sd">        :rtype: class solution</span>

<span class="sd">        :raise biogemeError: if a variable is set ot generic. Only groups of</span>
<span class="sd">            variables can be made generic.</span>

<span class="sd">        :raise biogemeError: if a group of variables is unknown</span>

<span class="sd">        :raise biogemeError: if an error occurs in setting the segmentation</span>
<span class="sd">            decisions</span>

<span class="sd">        :raise biogemeError: if the model is unknown.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="p">(</span><span class="n">nl</span><span class="p">,</span> <span class="n">generic</span><span class="p">)</span> <span class="ow">in</span> <span class="n">nonlinearSpecs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">theGroups</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">theGroups</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">activate</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">theGroups</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">makeGeneric</span><span class="p">(</span><span class="n">generic</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">nl</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">theGroups</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">setLinear</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">theGroups</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">setLinear</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">theGroups</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">setSelection</span><span class="p">(</span><span class="n">nl</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">theVariables</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">theVariables</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">active</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">theVariables</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">nonlinearSpecs</span> <span class="o">=</span> <span class="n">nl</span>
                <span class="k">if</span> <span class="n">generic</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">excep</span><span class="o">.</span><span class="n">biogemeError</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s1">&#39;Only groups of variables can &#39;</span>
                        <span class="sa">f</span><span class="s1">&#39;be made generic, not </span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s1">&#39;</span>
                    <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">excep</span><span class="o">.</span><span class="n">biogemeError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Unknown (group of) variable(s) </span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">seg</span> <span class="ow">in</span> <span class="n">segmentations</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">decisions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">theSegmentations</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">getDecisions</span><span class="p">()</span>
            <span class="n">decisions</span> <span class="o">=</span> <span class="p">{</span><span class="n">x</span><span class="p">:</span> <span class="kc">False</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">decisions</span><span class="p">}</span>
            <span class="n">decisions</span> <span class="o">=</span> <span class="p">{</span><span class="n">x</span><span class="p">:</span> <span class="kc">True</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">seg</span><span class="p">}</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">theSegmentations</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">setDecisions</span><span class="p">(</span><span class="n">decisions</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">excep</span><span class="o">.</span><span class="n">biogemeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">error_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;Error in segmentation of </span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s1">&#39;</span>
                <span class="k">raise</span> <span class="n">excep</span><span class="o">.</span><span class="n">biogemeError</span><span class="p">(</span><span class="n">error_msg</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selectedModel</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">pair</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">models</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">pair</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">model</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">selectedModel</span> <span class="o">=</span> <span class="n">i</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">selectedModel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">excep</span><span class="o">.</span><span class="n">biogemeError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Unknown model </span><span class="si">{</span><span class="n">model</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getSolution</span><span class="p">()</span></div>

<div class="viewcode-block" id="specificationProblem.getSolution"><a class="viewcode-back" href="../../assisted.html#biogeme.assisted.specificationProblem.getSolution">[docs]</a>    <span class="k">def</span> <span class="nf">getSolution</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Generate an object of the class ``solution``</span>

<span class="sd">        :return: the solution that has been generated</span>
<span class="sd">        :rtype: class solution</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">solution</span><span class="p">()</span>
        <span class="n">s</span><span class="o">.</span><span class="n">decisions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getDecisions</span><span class="p">()</span>
        <span class="n">s</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">describeCurrentModel</span><span class="p">()</span>
        <span class="n">s</span><span class="o">.</span><span class="n">objectives</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">archive</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">s</span></div>

<div class="viewcode-block" id="specificationProblem.setSolution"><a class="viewcode-back" href="../../assisted.html#biogeme.assisted.specificationProblem.setSolution">[docs]</a>    <span class="k">def</span> <span class="nf">setSolution</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">aSolution</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Import a solution defined as an object of class ``solution``.</span>

<span class="sd">        :param aSolution: solution to be imported.</span>
<span class="sd">        :type aSolution: class solution</span>

<span class="sd">        :raise biogemeError: if the object has the wrong type.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">aSolution</span><span class="p">,</span> <span class="n">vns</span><span class="o">.</span><span class="n">solutionClass</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">excep</span><span class="o">.</span><span class="n">biogemeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;Wrong type: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">aSolution</span><span class="p">)</span><span class="si">}</span><span class="s1"> &#39;</span>
                <span class="sa">f</span><span class="s1">&#39;instead of vns.solutionClass&#39;</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">setDecisions</span><span class="p">(</span><span class="n">aSolution</span><span class="o">.</span><span class="n">decisions</span><span class="p">)</span></div>

<div class="viewcode-block" id="specificationProblem.clone"><a class="viewcode-back" href="../../assisted.html#biogeme.assisted.specificationProblem.clone">[docs]</a>    <span class="k">def</span> <span class="nf">clone</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Clone the model, in order to generate neighbors</span>

<span class="sd">        :return: a clone</span>
<span class="sd">        :rtype: specificationProblem</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">c</span></div>

<div class="viewcode-block" id="specificationProblem.describeCurrentModel"><a class="viewcode-back" href="../../assisted.html#biogeme.assisted.specificationProblem.describeCurrentModel">[docs]</a>    <span class="k">def</span> <span class="nf">describeCurrentModel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Generates a description of the current model</span>

<span class="sd">        :return: model description.</span>
<span class="sd">        :rtype: str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">models</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">selectedModel</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">theAlternatives</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">title</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;Alternative </span><span class="si">{</span><span class="n">v</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1"> [</span><span class="si">{</span><span class="n">v</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s1">]</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">result</span> <span class="o">+=</span> <span class="s1">&#39;-&#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">result</span> <span class="o">+=</span> <span class="n">title</span>
            <span class="n">result</span> <span class="o">+=</span> <span class="s1">&#39;-&#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">v</span><span class="o">.</span><span class="n">terms</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">+=</span> <span class="n">t</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
                <span class="n">result</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="specificationProblem.describe"><a class="viewcode-back" href="../../assisted.html#biogeme.assisted.specificationProblem.describe">[docs]</a>    <span class="k">def</span> <span class="nf">describe</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">aSolution</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Generates (if necessary) and returns a short description of</span>
<span class="sd">            the solution</span>

<span class="sd">        :param aSolution: solution that must be described.</span>
<span class="sd">        :type aSolution: class solution</span>

<span class="sd">        :return: description of the solution</span>
<span class="sd">        :rtype: str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">aSolution</span><span class="o">.</span><span class="n">description</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">aSolution</span><span class="o">.</span><span class="n">description</span>
        <span class="n">solution</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">describeCurrentModel</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">solution</span><span class="o">.</span><span class="n">description</span></div>

<div class="viewcode-block" id="specificationProblem.describeHtml"><a class="viewcode-back" href="../../assisted.html#biogeme.assisted.specificationProblem.describeHtml">[docs]</a>    <span class="k">def</span> <span class="nf">describeHtml</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Generates a description of the model in HTML format.</span>

<span class="sd">        :return: description of the model in HTML format.</span>
<span class="sd">        :rtype: str</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s1">&#39;&lt;p&gt;&lt;strong&gt;Model: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">models</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">selectedModel</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span>
            <span class="sa">f</span><span class="s1">&#39;&lt;/strong&gt;&lt;/p&gt;&#39;</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">theAlternatives</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">title</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;&lt;p&gt;&lt;strong&gt;Alternative </span><span class="si">{</span><span class="n">v</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1"> [</span><span class="si">{</span><span class="n">v</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s1">]&lt;/strong&gt;&lt;/p&gt;&#39;</span>
            <span class="n">result</span> <span class="o">+=</span> <span class="n">title</span>
            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">v</span><span class="o">.</span><span class="n">terms</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">+=</span> <span class="s1">&#39;&lt;p&gt;&#39;</span>
                <span class="n">result</span> <span class="o">+=</span> <span class="n">html</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">describe</span><span class="p">(),</span> <span class="n">quote</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">result</span> <span class="o">+=</span> <span class="s1">&#39;&lt;/p&gt;&#39;</span>
                <span class="n">result</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="specificationProblem.isValid"><a class="viewcode-back" href="../../assisted.html#biogeme.assisted.specificationProblem.isValid">[docs]</a>    <span class="k">def</span> <span class="nf">isValid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">aSolution</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Evaluate  the validity of the solution.</span>

<span class="sd">        :param aSolution: solution to be checked</span>
<span class="sd">        :type aSolution: class solution</span>

<span class="sd">        :return: valid, why where valid is True if the solution is</span>
<span class="sd">            valid, and False otherwise. ``why`` contains an explanation why it</span>
<span class="sd">            is invalid.</span>
<span class="sd">        :rtype: tuple(bool, str)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">aSolution</span><span class="o">.</span><span class="n">valid</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">aSolution</span><span class="o">.</span><span class="n">valid</span><span class="p">,</span> <span class="n">aSolution</span><span class="o">.</span><span class="n">causeInvalidity</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setSolution</span><span class="p">(</span><span class="n">aSolution</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">excep</span><span class="o">.</span><span class="n">biogemeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Exception raised: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">aSolution</span><span class="o">.</span><span class="n">valid</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">aSolution</span><span class="o">.</span><span class="n">causeInvalidity</span> <span class="o">=</span> <span class="n">e</span>
            <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="n">e</span>

        <span class="n">estimationResults</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">archive</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">aSolution</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">estimationResults</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">estimationResults</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">aSolution</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">aSolution</span><span class="o">.</span><span class="n">valid</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">aSolution</span><span class="o">.</span><span class="n">valid</span><span class="p">,</span> <span class="n">aSolution</span><span class="o">.</span><span class="n">causeInvalidity</span>

        <span class="k">if</span> <span class="n">estimationResults</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">aSolution</span><span class="o">.</span><span class="n">valid</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">e</span> <span class="o">=</span> <span class="s1">&#39;Failed estimation&#39;</span>
            <span class="n">aSolution</span><span class="o">.</span><span class="n">causeInvalidity</span> <span class="o">=</span> <span class="n">e</span>
            <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="n">e</span>

        <span class="k">if</span> <span class="n">estimationResults</span><span class="o">.</span><span class="n">numberOfFreeParameters</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">aSolution</span><span class="o">.</span><span class="n">valid</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">e</span> <span class="o">=</span> <span class="s1">&#39;No parameter has been estimated&#39;</span>
            <span class="n">aSolution</span><span class="o">.</span><span class="n">causeInvalidity</span> <span class="o">=</span> <span class="n">e</span>
            <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="n">e</span>

        <span class="n">error_msg</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">ok</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">theAlternatives</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">u</span><span class="o">.</span><span class="n">terms</span><span class="p">:</span>
                <span class="n">tok</span><span class="p">,</span> <span class="n">tmsg</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">isValid</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">estimationResults</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">tok</span><span class="p">:</span>
                    <span class="n">ok</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="n">error_msg</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;, </span><span class="si">{</span><span class="n">tmsg</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="k">if</span> <span class="n">ok</span><span class="p">:</span>
            <span class="n">aSolution</span><span class="o">.</span><span class="n">valid</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">None</span>

        <span class="n">aSolution</span><span class="o">.</span><span class="n">valid</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">aSolution</span><span class="o">.</span><span class="n">causeInvalidity</span> <span class="o">=</span> <span class="n">error_msg</span>
        <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="n">error_msg</span></div>

<div class="viewcode-block" id="specificationProblem.evaluate"><a class="viewcode-back" href="../../assisted.html#biogeme.assisted.specificationProblem.evaluate">[docs]</a>    <span class="k">def</span> <span class="nf">evaluate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">aSolution</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Evaluate the objectives functions of the solution and store them in</span>
<span class="sd">        the solution object.</span>

<span class="sd">        :param aSolution: solution to be evaluated</span>
<span class="sd">        :type aSolution: solutionClass</span>

<span class="sd">        :return: results of the estimation</span>
<span class="sd">        :rtype: class :class:`biogeme.results.bioResults`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">estimationResults</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">archive</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">aSolution</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">estimationResults</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">estimationResults</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">setSolution</span><span class="p">(</span><span class="n">aSolution</span><span class="p">)</span>

        <span class="n">b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getBiogemeModel</span><span class="p">()</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">detailed</span><span class="p">(</span>
            <span class="sa">f</span><span class="s1">&#39;Evaluate model with &#39;</span>
            <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">id_manager</span><span class="o">.</span><span class="n">free_betas</span><span class="o">.</span><span class="n">names</span><span class="p">)</span><span class="si">}</span><span class="s1"> parameters.&#39;</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">id_manager</span><span class="o">.</span><span class="n">free_betas</span><span class="o">.</span><span class="n">names</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">estimationResults</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">archive</span><span class="p">[</span><span class="n">aSolution</span><span class="p">]</span> <span class="o">=</span> <span class="n">estimationResults</span>
            <span class="n">aSolution</span><span class="o">.</span><span class="n">valid</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">aSolution</span><span class="o">.</span><span class="n">causeInvalidity</span> <span class="o">=</span> <span class="s1">&#39;Model with 0 parameters&#39;</span>
            <span class="k">return</span> <span class="n">estimationResults</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">id_manager</span><span class="o">.</span><span class="n">free_betas</span><span class="o">.</span><span class="n">names</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">maximumNumberOfParameters</span><span class="p">:</span>
            <span class="n">estimationResults</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">archive</span><span class="p">[</span><span class="n">aSolution</span><span class="p">]</span> <span class="o">=</span> <span class="n">estimationResults</span>
            <span class="n">aSolution</span><span class="o">.</span><span class="n">valid</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">aSolution</span><span class="o">.</span><span class="n">causeInvalidity</span> <span class="o">=</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;More than </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">maximumNumberOfParameters</span><span class="si">}</span><span class="s1">&#39;</span>
                <span class="sa">f</span><span class="s1">&#39; parameters: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">id_manager</span><span class="o">.</span><span class="n">free_betas</span><span class="o">.</span><span class="n">names</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="n">estimationResults</span>

        <span class="n">algoParameters</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;proportionAnalyticalHessian&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span> <span class="s1">&#39;maxiter&#39;</span><span class="p">:</span> <span class="mi">200</span><span class="p">}</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">temporarySilence</span><span class="p">()</span>
            <span class="n">estimationResults</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">quickEstimate</span><span class="p">(</span><span class="n">algoParameters</span><span class="o">=</span><span class="n">algoParameters</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">resume</span><span class="p">()</span>
            <span class="n">aSolution</span><span class="o">.</span><span class="n">objectives</span> <span class="o">=</span> <span class="p">[</span>
                <span class="o">-</span><span class="n">estimationResults</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">logLike</span><span class="p">,</span>
                <span class="n">estimationResults</span><span class="o">.</span><span class="n">numberOfFreeParameters</span><span class="p">(),</span>
            <span class="p">]</span>

        <span class="k">except</span> <span class="n">excep</span><span class="o">.</span><span class="n">biogemeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Exception raised: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">estimationResults</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">aSolution</span><span class="o">.</span><span class="n">valid</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">aSolution</span><span class="o">.</span><span class="n">causeInvalidity</span> <span class="o">=</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;Exception raised during estimation: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s1">&#39;</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">archive</span><span class="p">[</span><span class="n">aSolution</span><span class="p">]</span> <span class="o">=</span> <span class="n">estimationResults</span>
        <span class="k">return</span> <span class="n">estimationResults</span></div>

<div class="viewcode-block" id="specificationProblem.checkAvailability"><a class="viewcode-back" href="../../assisted.html#biogeme.assisted.specificationProblem.checkAvailability">[docs]</a>    <span class="k">def</span> <span class="nf">checkAvailability</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Check the availability of each operator.</span>

<span class="sd">        :return: a dictionary with the availability status of each operator</span>
<span class="sd">        :rtype: dict(str: bool)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">av</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span><span class="p">(</span><span class="n">audit</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">operators</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
        <span class="k">return</span> <span class="n">av</span></div>

<div class="viewcode-block" id="specificationProblem.generateNeighbor"><a class="viewcode-back" href="../../assisted.html#biogeme.assisted.specificationProblem.generateNeighbor">[docs]</a>    <span class="k">def</span> <span class="nf">generateNeighbor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">aSolution</span><span class="p">,</span> <span class="n">neighborhoodSize</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates a neighbor of the solution.</span>

<span class="sd">        :param aSolution: solution to be modified</span>
<span class="sd">        :type aSolution: class solution</span>

<span class="sd">        :param neighborhoodSize: size of the neighborhood to be applied</span>
<span class="sd">        :type neighborhoodSize: int</span>

<span class="sd">        :return: a neighbor solution, and the number of changes that have been</span>
<span class="sd">                 actually applied.</span>
<span class="sd">        :rtype: tuple(class solution, int)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setSolution</span><span class="p">(</span><span class="n">aSolution</span><span class="p">)</span>
        <span class="c1"># Identify the operators available for the current specification</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">operatorsManagement</span><span class="o">.</span><span class="n">available</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">checkAvailability</span><span class="p">()</span>
        <span class="c1"># Select one operator.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lastOperator</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">operatorsManagement</span><span class="o">.</span><span class="n">selectOperator</span><span class="p">()</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">detailed</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Apply operator </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">lastOperator</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">changes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">applyOperator</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lastOperator</span><span class="p">,</span> <span class="n">neighborhoodSize</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getSolution</span><span class="p">(),</span> <span class="n">changes</span></div>

<div class="viewcode-block" id="specificationProblem.neighborRejected"><a class="viewcode-back" href="../../assisted.html#biogeme.assisted.specificationProblem.neighborRejected">[docs]</a>    <span class="k">def</span> <span class="nf">neighborRejected</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">aSolution</span><span class="p">,</span> <span class="n">aNeighbor</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Notify that a neighbor has been rejected by the</span>
<span class="sd">        algorithm. Used to update the statistics on the operators.</span>

<span class="sd">        :param aSolution: solution modified. Not used in this implementation.</span>
<span class="sd">        :type aSolution: class solution</span>

<span class="sd">        :param aNeighbor: neighbor</span>
<span class="sd">        :type aNeighbor: solutionClass</span>

<span class="sd">        :raise biogemeError: if no operator has been used yet.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lastOperator</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">excep</span><span class="o">.</span><span class="n">biogemeError</span><span class="p">(</span><span class="s1">&#39;No operator has been used yet.&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">operatorsManagement</span><span class="o">.</span><span class="n">decreaseScore</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lastOperator</span><span class="p">)</span></div>

<div class="viewcode-block" id="specificationProblem.neighborAccepted"><a class="viewcode-back" href="../../assisted.html#biogeme.assisted.specificationProblem.neighborAccepted">[docs]</a>    <span class="k">def</span> <span class="nf">neighborAccepted</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">aSolution</span><span class="p">,</span> <span class="n">aNeighbor</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Notify that a neighbor has been accepted by the</span>
<span class="sd">        algorithm. Used to update the statistics on the operators.</span>

<span class="sd">        :param aSolution: solution modified. Not used in this implementation.</span>
<span class="sd">        :type aSolution: solutionClass</span>

<span class="sd">        :param aNeighbor: neighbor</span>
<span class="sd">        :type aNeighbor: solutionClass</span>

<span class="sd">        :raise biogemeError: if no operator has been used yet.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lastOperator</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">excep</span><span class="o">.</span><span class="n">biogemeError</span><span class="p">(</span><span class="s1">&#39;No operator has been used yet.&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">operatorsManagement</span><span class="o">.</span><span class="n">increaseScore</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lastOperator</span><span class="p">)</span></div>

<div class="viewcode-block" id="specificationProblem.applyOperator"><a class="viewcode-back" href="../../assisted.html#biogeme.assisted.specificationProblem.applyOperator">[docs]</a>    <span class="k">def</span> <span class="nf">applyOperator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Apply an operator.</span>

<span class="sd">        :param name: name of the operator to apply</span>
<span class="sd">        :type name: str</span>

<span class="sd">        :param size: size of the neighborhood</span>
<span class="sd">        :type size: int</span>

<span class="sd">        :return: total number of changes actually made on the solution</span>
<span class="sd">        :rtype: int</span>

<span class="sd">        :raise biogemeError: if the name of the operator is unknown.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">op</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">operators</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">op</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">excep</span><span class="o">.</span><span class="n">biogemeError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Unknowns operator: </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">op</span><span class="p">(</span><span class="n">size</span><span class="p">)</span></div>

<div class="viewcode-block" id="specificationProblem.changeSegmentation"><a class="viewcode-back" href="../../assisted.html#biogeme.assisted.specificationProblem.changeSegmentation">[docs]</a>    <span class="k">def</span> <span class="nf">changeSegmentation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">audit</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Change the interaction, while keeping the number of them</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">totalChanges</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">segments</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theSegmentations</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">segments</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">segments</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">theSegmentations</span><span class="p">[</span><span class="n">s</span><span class="p">]</span><span class="o">.</span><span class="n">isActive</span><span class="p">():</span>
                <span class="n">changes</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">theSegmentations</span><span class="p">[</span><span class="n">s</span><span class="p">]</span><span class="o">.</span><span class="n">getDecisions</span><span class="p">()</span>
                <span class="n">active</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">v</span><span class="p">]</span>
                <span class="n">inactive</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">v</span><span class="p">]</span>
                <span class="n">changes</span> <span class="o">=</span> <span class="nb">min</span><span class="p">([</span><span class="n">size</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">active</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">inactive</span><span class="p">)])</span>
                <span class="n">totalChanges</span> <span class="o">+=</span> <span class="n">changes</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">audit</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">changes</span><span class="p">):</span>
                        <span class="n">newd</span> <span class="o">=</span> <span class="n">d</span>
                        <span class="n">newd</span><span class="p">[</span><span class="n">active</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">False</span>
                        <span class="n">newd</span><span class="p">[</span><span class="n">inactive</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">theSegmentations</span><span class="p">[</span><span class="n">s</span><span class="p">]</span><span class="o">.</span><span class="n">setDecisions</span><span class="p">(</span><span class="n">newd</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">totalChanges</span> <span class="o">==</span> <span class="n">size</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">totalChanges</span>
        <span class="k">return</span> <span class="n">totalChanges</span></div>

<div class="viewcode-block" id="specificationProblem.increaseSegmentation"><a class="viewcode-back" href="../../assisted.html#biogeme.assisted.specificationProblem.increaseSegmentation">[docs]</a>    <span class="k">def</span> <span class="nf">increaseSegmentation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">audit</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a level of segmentation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">candidates</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">segments</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theSegmentations</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">segments</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">theSegmentations</span><span class="p">[</span><span class="n">s</span><span class="p">]</span><span class="o">.</span><span class="n">isActive</span><span class="p">():</span>
                <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">theSegmentations</span><span class="p">[</span><span class="n">s</span><span class="p">]</span><span class="o">.</span><span class="n">getDecisions</span><span class="p">()</span>
                <span class="n">inactive</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">v</span><span class="p">]</span>
                <span class="n">candidates</span> <span class="o">+=</span> <span class="p">[(</span><span class="n">s</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">inactive</span><span class="p">]</span>

        <span class="n">changes</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">candidates</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">audit</span><span class="p">:</span>
            <span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">candidates</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">changes</span><span class="p">):</span>
                <span class="n">s</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">candidates</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">theSegmentations</span><span class="p">[</span><span class="n">s</span><span class="p">]</span><span class="o">.</span><span class="n">getDecisions</span><span class="p">()</span>
                <span class="n">d</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">theSegmentations</span><span class="p">[</span><span class="n">s</span><span class="p">]</span><span class="o">.</span><span class="n">setDecisions</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">changes</span></div>

<div class="viewcode-block" id="specificationProblem.decreaseSegmentation"><a class="viewcode-back" href="../../assisted.html#biogeme.assisted.specificationProblem.decreaseSegmentation">[docs]</a>    <span class="k">def</span> <span class="nf">decreaseSegmentation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">audit</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Remove a level of segmentation.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">candidates</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">segments</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theSegmentations</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">segments</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">theSegmentations</span><span class="p">[</span><span class="n">s</span><span class="p">]</span><span class="o">.</span><span class="n">isActive</span><span class="p">():</span>
                <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">theSegmentations</span><span class="p">[</span><span class="n">s</span><span class="p">]</span><span class="o">.</span><span class="n">getDecisions</span><span class="p">()</span>
                <span class="n">active</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">v</span><span class="p">]</span>
                <span class="n">candidates</span> <span class="o">+=</span> <span class="p">[(</span><span class="n">s</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">active</span><span class="p">]</span>

        <span class="n">changes</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">candidates</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">audit</span><span class="p">:</span>
            <span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">candidates</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">changes</span><span class="p">):</span>
                <span class="n">s</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">candidates</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">theSegmentations</span><span class="p">[</span><span class="n">s</span><span class="p">]</span><span class="o">.</span><span class="n">getDecisions</span><span class="p">()</span>
                <span class="n">d</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">theSegmentations</span><span class="p">[</span><span class="n">s</span><span class="p">]</span><span class="o">.</span><span class="n">setDecisions</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">changes</span></div>

<div class="viewcode-block" id="specificationProblem.changeLinearity"><a class="viewcode-back" href="../../assisted.html#biogeme.assisted.specificationProblem.changeLinearity">[docs]</a>    <span class="k">def</span> <span class="nf">changeLinearity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">audit</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Make linear if non linear, and the other way around.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">groups</span> <span class="o">=</span> <span class="p">[</span><span class="n">g</span> <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">theGroups</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">theGroups</span><span class="p">[</span><span class="n">g</span><span class="p">]</span><span class="o">.</span><span class="n">active</span><span class="p">]</span>
        <span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">groups</span><span class="p">)</span>
        <span class="n">changes</span> <span class="o">=</span> <span class="nb">min</span><span class="p">([</span><span class="n">size</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">groups</span><span class="p">)])</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">audit</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">changes</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">theGroups</span><span class="p">[</span><span class="n">groups</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span><span class="o">.</span><span class="n">swapLinear</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">changes</span></div>

<div class="viewcode-block" id="specificationProblem.changeVariables"><a class="viewcode-back" href="../../assisted.html#biogeme.assisted.specificationProblem.changeVariables">[docs]</a>    <span class="k">def</span> <span class="nf">changeVariables</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">audit</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Activate groups of variables</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">groups</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">g</span>
            <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">theGroups</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">theGroups</span><span class="p">[</span><span class="n">g</span><span class="p">]</span><span class="o">.</span><span class="n">alwaysActive</span>
        <span class="p">]</span>
        <span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">groups</span><span class="p">)</span>
        <span class="n">changes</span> <span class="o">=</span> <span class="nb">min</span><span class="p">([</span><span class="n">size</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">groups</span><span class="p">)])</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">audit</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">changes</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">theGroups</span><span class="p">[</span><span class="n">groups</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span><span class="o">.</span><span class="n">swapActivate</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">changes</span></div>

<div class="viewcode-block" id="specificationProblem.changeGeneric"><a class="viewcode-back" href="../../assisted.html#biogeme.assisted.specificationProblem.changeGeneric">[docs]</a>    <span class="k">def</span> <span class="nf">changeGeneric</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">audit</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Change generic vs alternative specific status</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">groups</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">g</span>
            <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">theGroups</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">theGroups</span><span class="p">[</span><span class="n">g</span><span class="p">]</span><span class="o">.</span><span class="n">active</span>
            <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">theGroups</span><span class="p">[</span><span class="n">g</span><span class="p">]</span><span class="o">.</span><span class="n">genericForbiden</span>
        <span class="p">]</span>
        <span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">groups</span><span class="p">)</span>
        <span class="n">changes</span> <span class="o">=</span> <span class="nb">min</span><span class="p">([</span><span class="n">size</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">groups</span><span class="p">)])</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">audit</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">changes</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">theGroups</span><span class="p">[</span><span class="n">groups</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span><span class="o">.</span><span class="n">swapGeneric</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">changes</span></div>

<div class="viewcode-block" id="specificationProblem.changeNonlinearity"><a class="viewcode-back" href="../../assisted.html#biogeme.assisted.specificationProblem.changeNonlinearity">[docs]</a>    <span class="k">def</span> <span class="nf">changeNonlinearity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">audit</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Change the nature of the nonlinear specification</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">groups</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">g</span>
            <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">theGroups</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">theGroups</span><span class="p">[</span><span class="n">g</span><span class="p">]</span><span class="o">.</span><span class="n">active</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">theGroups</span><span class="p">[</span><span class="n">g</span><span class="p">]</span><span class="o">.</span><span class="n">linear</span>
        <span class="p">]</span>
        <span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">groups</span><span class="p">)</span>
        <span class="n">changes</span> <span class="o">=</span> <span class="nb">min</span><span class="p">([</span><span class="n">size</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">groups</span><span class="p">)])</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">audit</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">changes</span><span class="p">):</span>
                <span class="c1"># We need to select randomly a specification different</span>
                <span class="c1"># from the current one</span>
                <span class="n">nbrOfValues</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theGroups</span><span class="p">[</span><span class="n">groups</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span><span class="o">.</span><span class="n">nonlinearSpecs</span><span class="p">)</span>
                <span class="n">values</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">nbrOfValues</span><span class="p">))</span>
                <span class="n">values</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theGroups</span><span class="p">[</span><span class="n">groups</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span><span class="o">.</span><span class="n">selection</span><span class="p">)</span>
                <span class="n">sel</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">values</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">theGroups</span><span class="p">[</span><span class="n">groups</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span><span class="o">.</span><span class="n">setSelection</span><span class="p">(</span><span class="n">sel</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">changes</span></div>

<div class="viewcode-block" id="specificationProblem.changeModel"><a class="viewcode-back" href="../../assisted.html#biogeme.assisted.specificationProblem.changeModel">[docs]</a>    <span class="k">def</span> <span class="nf">changeModel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">audit</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Select randomly another model from the list</span>

<span class="sd">        :param size: not used here. Must be there for compliance with the</span>
<span class="sd">            call of operators.</span>
<span class="sd">        :type size: int</span>

<span class="sd">        :param audit: if True, returns the number of changes without</span>
<span class="sd">            actually implementing them.</span>
<span class="sd">        :type audit: bool</span>

<span class="sd">        :return: 0 if no other model could be found. 1 otherwise.</span>
<span class="sd">        :rtype: int</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">candidates</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">models</span><span class="p">)))</span>
        <span class="n">candidates</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">selectedModel</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">candidates</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">audit</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">selectedModel</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">candidates</span><span class="p">))</span>
        <span class="k">return</span> <span class="mi">1</span></div></div>


<div class="viewcode-block" id="solution"><a class="viewcode-back" href="../../assisted.html#biogeme.assisted.solution">[docs]</a><span class="k">class</span> <span class="nc">solution</span><span class="p">(</span><span class="n">vns</span><span class="o">.</span><span class="n">solutionClass</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class representing one solution, that is, one model specification.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="solution.__init__"><a class="viewcode-back" href="../../assisted.html#biogeme.assisted.solution.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">objectivesNames</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Neg. log likelihood&#39;</span><span class="p">,</span> <span class="s1">&#39;#parameters&#39;</span><span class="p">]</span>
        <span class="sd">&quot;&quot;&quot; Names of the objective functions</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">objectives</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1">#: values of the objectives</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">valid</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1">#: True if the solution is valid</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">causeInvalidity</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="sd">&quot;&quot;&quot;If the solution is invalid, contains the cause of the invalidity</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">decisions</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The decisions consist of:</span>

<span class="sd">        - a dict of decisions for each group of variables.</span>
<span class="sd">        - for each utility, a list of decisions for each term.</span>
<span class="sd">        - the selected model</span>

<span class="sd">        Type: tuple(dict(str: int), dict(str: list(dict(str: bool))), int)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1">#: description of the solution</span></div>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">decisions</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">description</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">excep</span><span class="o">.</span><span class="n">biogemeError</span><span class="p">(</span>
                <span class="s1">&#39;Description of the solution not available&#39;</span>
            <span class="p">)</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">description</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">objectivesNames</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">excep</span><span class="o">.</span><span class="n">biogemeError</span><span class="p">(</span>
                <span class="s1">&#39;The attribute objectivesNames is not defined&#39;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">objectives</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">excep</span><span class="o">.</span><span class="n">biogemeError</span><span class="p">(</span><span class="s1">&#39;The attribute objectives is not defined&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">t</span><span class="p">,</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">objectivesNames</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">objectives</span><span class="p">):</span>
            <span class="n">res</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="si">{</span><span class="n">t</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">r</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="k">return</span> <span class="n">res</span></div>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Michel Bierlaire.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>